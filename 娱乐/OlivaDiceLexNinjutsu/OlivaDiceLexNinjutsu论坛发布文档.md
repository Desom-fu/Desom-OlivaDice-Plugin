# 【娱乐插件】蕾忍释放忍术语音插件

- **名称**：释放忍术语音插件
- **作者**：Desom-fu（移植）
- **版本**：1.2.0
- **兼容版本**：理论兼容所有版本，但仅在最新版本测试过
- **平台**：理论支持全平台（已在 QQ 部署测试）
- **操作系统**：理论支持全系统（在 Windows Server 2019 上部署）

---

## 特别鸣谢

本插件基于 koishi-plugin-lex-ninjutsu 移植而来，特别感谢原作者的创意与实现！

- **原作者**：凛素子
- **bilibili空间**：https://space.bilibili.com/397472054
- **发布视频**：https://www.bilibili.com/video/BV1CDMGzLEoN/
- **原koishi项目地址**：https://github.com/rinsoko39/koishi-plugin-lex-ninjutsu

---

## 下载

- ###### **插件包（记得解压！）**：

---

## 前置依赖

### 强制要求
- **OlivaDiceCore**：本插件的核心依赖，必须安装

### 非强制要求（可选）
- **pypinyin**：用于启用拼音及同音匹配搜索功能
  - **注意**：此功能需要使用**源码运行**才能使用
  - **安装方法**：
    1. 确保电脑安装了 `python 3.6+`
    2. 使用命令安装：`pip install pypinyin`
    3. 安装后重载插件即可

---

## 推荐配合使用

配合这个蕾忍跑团插件使用更佳：https://forum.olivos.run/d/818

---

## 核心功能

握握手，握握双手。本插件提供了从忍法帖获取忍术数据并在青果骰中播放忍术音频的完整功能：

1. **忍术数据管理**
   - 从在线忍法帖数据库（https://wsfrs.com/）获取忍术信息
   - 数据持久化保存到本地（`./plugin/data/OlivaDiceLexNinjutsu/`）
   - 重启后自动加载历史数据
   - 支持清空数据重新获取

2. **忍术查询与搜索**
   - 查看忍术详细信息
   - 支持模糊搜索忍术
   - 自动忽略标点符号匹配
   - 支持同音匹配（需安装 pypinyin 库）
   - 可自定义搜索结果上限和描述预览字数

3. **忍术音频播放**
   - 释放忍术时播放音频
   - 支持本地音频优先播放
   - 支持全部忍术音频批量下载
   - 音频自动保存到本地（`./data/audios/OlivaDiceLexNinjutsu/`）
   - 断点续传和失败重试机制

4. **灵活配置**
   - 通过回复词自定义配置参数
   - 匹配等级可调（严格/忽略标点/同音）
   - 搜索结果上限可调
   - 描述预览字数可调

---

## 命令一览

| 命令                        | 权限要求 | 功能                      |
| ------------------------- | ---- | ----------------------- |
| `.忍术 释放 <忍术名>`            | 普通用户 | 释放忍术，播放忍术音频             |
| `.释放忍术 <忍术名>`             | 普通用户 | 释放忍术，播放忍术音频（快捷命令）       |
| `.忍术 信息 <忍术名>`            | 普通用户 | 获取忍术详细信息                |
| `.忍术 搜索 <关键字>`            | 普通用户 | 搜索包含关键词的忍术              |
| `.忍术 更新`                   | 需要权限 | 从忍法帖更新忍术数据库             |
| `.忍术 清空`                   | 需要权限 | 清空当前忍术数据库               |
| `.忍术 下载`                   | 需要权限 | 下载全部忍术音频到本地（需要较长时间）     |
| `.忍术 配置`                   | 普通用户 | 查看当前配置参数                |
| `.help 忍术帮助`                    | 普通用户 | 查看完整帮助信息                |

---

## 使用示例

### 1. 更新忍术数据库

**命令**：
```
.忍术 更新
```

**回复**：
```
忍术信息已更新，共 XXX 个忍术。
```

### 2. 释放忍术（播放音频）

**命令**：
```
.忍术 释放 握握手握握双手
```
或
```
.释放忍术 握握手握握双手
```

**回复**：
```
[音频播放]
```

**说明**：
- 如果本地已下载该忍术音频，会直接播放本地音频（速度更快）
- 如果本地没有，会从忍法帖在线获取并播放
- 如果忍术没有音频，会提示"该忍术暂无音频"

### 3. 查看忍术信息

**命令**：
```
.忍术 信息 吓我一跳我释放忍术
```

**回复**：
```
吓我一跳我释放忍术
[忍术描述内容]
更多信息：https://wsfrs.com/jutsus/xxx
```

### 4. 搜索忍术

**命令**：
```
.忍术 搜索 握手
```

**回复**：
```
找到以下相关忍术：
握握手握握双手
简介：[描述内容]…
某某忍术
简介：[描述内容]…
```

**说明**：
- 自动忽略标点符号进行匹配
- 如果安装了 pypinyin 库，支持同音匹配（例如搜索"握手"可以找到"沃寿"）
- 搜索结果默认最多显示 10 个（可通过回复词配置调整）

### 5. 下载全部忍术音频

**命令**：
```
.忍术 下载
```

**回复**：
```
开始下载全部忍术音频……
共 XXX 个忍术，预计需要一些时间

（下载完成后）
下载完成！
成功: XX 个忍术
失败: XX 个忍术
总音频: XX 个
保存位置: ./data/audios/OlivaDiceLexNinjutsu/
```

**说明**：
- 此操作会下载所有忍术的音频文件，可能需要较长时间
- 支持断点续传，中途中断可以继续下载
- 失败的音频会自动重试 3 次
- 下载后的音频会在后续释放忍术时优先使用

### 6. 查看配置信息

**命令**：
```
.忍术 配置
```

**回复**：
```
【忍术配置信息】
匹配等级: 2
搜索结果上限: 10
描述预览字数: 50
```

---

## 配置参数说明

本插件支持通过回复词自定义以下配置参数（在后台管理中找到 `OlivaDiceLexNinjutsu` 的回复词设置）：

### 1. 匹配等级 (tMatchLevel)

控制搜索和查询时的匹配严格程度：

| 等级 | 说明         | 示例                      |
| -- | ---------- | ----------------------- |
| 0  | 严格匹配       | 必须完全一致（包括标点）            |
| 1  | 忽略标点匹配     | "握握手握握双手" = "握握手，握握双手" |
| 2  | 同音匹配（需要库） | "握手" 可以匹配 "沃寿"         |

**默认值**：
- 如果未安装 pypinyin 库：`1`（忽略标点匹配）
- 如果安装了 pypinyin 库：`2`（同音匹配）

### 2. 搜索结果上限 (tSearchLimit)

控制搜索命令返回的最大结果数量。

**默认值**：`10`

### 3. 描述预览字数 (tDescriptionPreviewLimit)

控制搜索结果中忍术描述的显示长度（超出部分用"…"省略）。

**默认值**：`50`

---

## 数据存储说明

### 忍术数据
- **存储位置**：`./plugin/data/OlivaDiceLexNinjutsu/ninjutsu_data.json`
- **内容**：从忍法帖获取的所有忍术信息
- **持久化**：重启后自动加载，无需重新下载

### 音频文件
- **存储位置**：`./data/audios/OlivaDiceLexNinjutsu/[忍术名]/`
- **格式**：每个忍术的音频文件独立保存在各自的文件夹中
- **优先级**：释放忍术时优先使用本地音频

---

## 注意事项

1. **首次使用**  
   首次使用前请先执行 `.忍术 更新` 命令获取忍术数据（需要管理员权限）

2. **网络连接**  
   更新忍术数据和在线播放音频需要联网访问 https://wsfrs.com/

3. **音频下载**  
   - 全部音频下载可能需要较长时间和较大存储空间
   - 建议在网络稳定时进行
   - 支持断点续传，中途中断可以继续

4. **权限要求**  
   - 普通用户：可以释放忍术、查询信息、搜索忍术
   - 管理员及以上：可以更新数据、清空数据、下载音频

5. **拼音匹配功能**  
   - 拼音同音匹配需要安装 `pypinyin` 库
   - 仅源码运行方式支持此功能
   - 如未安装，仍可使用普通搜索功能

6. **数据来源**  
   所有忍术数据来自忍法帖（https://wsfrs.com/），感谢凛素子和忍法帖项目组的贡献！

---

## 截图示例


---

## 更新日志

### v1.2.0
- 支持从忍法帖获取忍术数据
- 实现忍术音频播放功能
- 支持本地音频缓存
- 支持拼音及同音匹配（可选）
- 支持模糊搜索功能
- 数据持久化保存
- 支持全部音频批量下载
- 通过回复词自定义配置参数

---

## 问题反馈

如遇到问题或有建议，欢迎：在论坛相关帖子下留言

---

## 开源协议

本插件遵循原项目的开源协议 MIT 。

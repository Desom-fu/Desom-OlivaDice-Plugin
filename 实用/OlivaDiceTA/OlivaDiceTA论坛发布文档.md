# 三角机构模块（Triangle Agency跑团专用插件+人物卡模板）

- **名称**​：三角机构模块
- ​**作者**​：Desom-fu
- ​**版本**​：1.0.0
- ​**兼容版本**​：理论兼容所有版本，但仅在最新版本测试过
- ​**平台**​：理论支持全平台（仅在 QQ 部署测试过）
- ​**操作系统**​：理论支持全系统（仅在 Windows Server 2019 上部署过）
- **前置插件**：OlivaDiceCore

---

## 注意事项

- 建议使用最新构建版`OlivaDiceCore`以获得最佳体验
- 下载地址：https://github.com/OlivOS-Team/OlivaDiceCore/actions
- （记得解压！）

- 建议使用最新构建版`OlivaDiceNativeGUI`以获得最佳体验
- 下载地址：https://github.com/Desom-fu/OlivaDiceNativeGUI/actions
- （记得解压！）

- 下载完毕后建议打开`OlivaDice 设置面板`的自定义回复，在回复词中的`配置回复模块`里面新增一行`OlivaDiceTA`（注意大小写要完全一致!）

---

## 下载

- ###### ​**插件包（记得解压！）** ​:

- ###### **三角机构青果专用人物卡模板（解压！）** :

---

## 更新日志

## 2025.9.18 v1.0.0发布：
- 三角机构插件发布
- 支持完整的三角机构检定系统
- 包含燃尽机制和混沌值系统
- 支持现实改写检定和失败追踪
- 自动处理三重升华和三角稳定判定
- 支持表达式系统和技能值替换
- 支持代投功能和权限管理

---

## 核心功能

### 检定系统
- 新增 `.ta <属性/表达式>` 命令，用来进行三角机构技能检定
- 新增 `.tr <属性/表达式>` 命令，用来进行现实改写检定
- 支持多次检定：`.ta3#专注` 进行3次专注检定
- 支持参数修正：
  - `c` 参数：不产生混沌值
  - `f` 参数：不消耗现实改写失败次数（仅.tr）
  - `b数字` 参数：奖励骰子（强制将指定数量的非3改为3）
  - `p数字` 参数：惩罚骰子（强制将指定数量的3改为非3）

### 状态管理
- 新增 `.tcs` 命令，用于管理群组混沌值
  - `.tcs` - 查看当前混沌值
  - `.tcs 数值` - 设置混沌值
  - `.tcs +数值` - 增加混沌值
  - `.tcs -数值` - 减少混沌值
  - 支持表达式：`.tcs 1d6+2`、`.tcs 力量/2`
  
- 新增 `.tfs` 命令，用于管理现实改写失败次数
  - `.tfs` - 查看当前失败次数
  - `.tfs 数值` - 设置失败次数
  - `.tfs +数值` - 增加失败次数
  - `.tfs -数值` - 减少失败次数
  - 支持表达式：`.tfs 1d3`、`.tfs 智力/10`

### 代投功能
- 支持管理员代投：`.ta @用户 属性名`
- 支持多次代投：`.ta3#@用户 专注`
- 自动识别目标用户的人物卡数据

---

## 游戏机制详解

### 基础检定规则
- **骰子系统**：投掷6D4，统计结果中3的个数
- **成功判定**：
  - 0个3：失败
  - 1-2个3：成功
  - 3个3：特殊情况（见下文）

### 特殊机制
- **三重升华**：原始骰子就有3个3 → 大成功，不产生混沌值
- **三角稳定**：经过修正后恰好3个3 → 成功，不产生混沌值
- **燃尽效果**：属性值≤0时产生燃尽，将骰子中的3强制改为非3
  - 属性0时：1点燃尽
  - 属性-1时：2点燃尽，以此类推
- **混沌生成**：根据公式 `6 - 最终3的个数 + 燃尽次数 + 惩罚次数` 计算

### 现实改写系统
- **现实改写检定**：使用`.tr`命令进行
- **失败惩罚**：.tr检定失败时增加现实改写失败次数
- **燃尽叠加**：现实改写失败次数会增加.tr检定的燃尽值

---

## 人物卡系统

### 核心属性（9个）
- **专注(ATT)**：注意力和集中力
- **共情(EMP)**：理解他人情感的能力
- **仪态(PRE)**：存在感和表现力
- **顽固(PER)**：坚持和毅力
- **双面(DUP)**：欺骗和伪装能力
- **先机(INI)**：主动性和反应速度
- **敬业(PRO)**：专业技能和职业素养
- **外向(DYN)**：动态表达和社交能力
- **精微(SUB)**：细致观察和精确操作

### 模板特性
- **主骰设置**：自动设置为6D4
- **别名支持**：支持英文缩写（ATT、EMP等）和大写全名（ATTENTION、EMPATHY等）
- **名片显示**：简洁显示角色名称
- **质保机制**：属性值直接代表可用的质保数量

---

## 使用示例

```
# 基础检定
.ta 专注          # 使用专注属性进行检定
.ta ATT           # 使用英文缩写
.ta 15            # 直接使用数值检定

# 表达式检定  
.ta 专注+3        # 专注属性+3的检定
.ta 1d6+2         # 骰子表达式检定
.ta 力量/2        # 属性运算检定

# 现实改写检定
.tr 共情          # 现实改写检定
.tr 共情 f        # 不消耗失败次数的现实改写

# 参数检定
.ta 专注 b2       # 2个奖励骰子
.ta 专注 p1 c     # 1个惩罚骰子，不产生混沌值

# 多次检定
.ta3#专注         # 3次专注检定
.tr2#共情 c       # 2次现实改写，不产生混沌值

# 代投
.ta @小明 专注    # 为小明进行专注检定
.ta3#@小明 共情   # 为小明进行3次共情检定

# 状态管理
.tcs              # 查看混沌值
.tcs 10           # 设置混沌值为10
.tcs +1d6         # 增加1d6点混沌值
.tcs -专注        # 减少等于专注属性的混沌值

.tfs              # 查看现实改写失败
.tfs +1           # 增加1次失败
.tfs 智力/5       # 设置失败次数为智力/5
```

---

## 技术特性

### 表达式系统
- **技能替换**：自动识别人物卡中的属性和技能
- **骰子支持**：完整支持OlivaDice的骰子表达式
- **运算符**：支持 `+`、`-`、`*`、`/`、`()`等运算
- **详情显示**：显示完整的计算过程

### 数据存储
- **哈希路径**：使用哈希值避免文件名冲突
- **群组隔离**：每个群组的数据独立存储
- **私聊支持**：私聊时使用用户哈希存储

### 兼容性
- **OlivaDiceCore集成**：完整兼容核心功能
- **权限系统**：支持管理员权限和代投
- **多平台**：理论支持所有OlivOS支持的平台

---

## 安装指南

1. **下载插件**：下载OlivaDiceTA插件包和OlivaDiceCore，OlivaNativeGUI并解压
2. **安装插件**：将插件文件夹放入OlivOS的`plugin\app`目录
3. **配置回复**：在设置面板的自定义回复中添加`OlivaDiceTA`
4. **导入模板**：将ta.json放入人物卡模板目录:``plugin\data\OlivaDice\unity\extend\template``
5. **切换规则**：使用`.st ta`切换到三角机构规则
6. **创建角色**：使用`.pc new 角色名`创建新角色

---

## 常见问题

**Q: 为什么投出6个3还是成功而不是大成功？**
A: 只有原始骰子就有3个3才是真正的三重升华大成功。通过奖励骰子等方式获得的3个以上3，按普通成功处理。

**Q: 三角稳定是什么？**
A: 当原始骰子不是3个3，但经过各种修正后变成恰好3个3时，触发三角稳定，显示为成功且不产生混沌值。

**Q: 燃尽是如何计算的？**
A: 燃尽值 = 属性燃尽 + 现实改写失败燃尽(.tr时)，其中属性燃尽 = max(0, 1-属性值)。

**Q: 混沌值什么时候增加？**
A: 除了三重升华和三角稳定外，其他情况都会根据公式产生混沌值：6 - 最终3的个数 + 燃尽次数 + 惩罚次数。

---

## 联系与反馈

如有问题或建议，请联系作者：Desom-fu

感谢使用三角机构模块！愿你在神秘的三角机构世界中，探索现实的边界。